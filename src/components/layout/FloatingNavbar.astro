---
---

<nav class="relative z-[1] flex items-center gap-2 rounded-full border border-panel-border bg-panel-background p-1 shadow-card" aria-label="Main navigation" data-astro-transition-scope="navbar">
  <div class="absolute h-[90%] rounded-full bg-theme-3 transition-all duration-300 ease-out sliding-indicator"></div>
  <a href="/work" class="z-[1] rounded-full px-4 py-1 text-sm text-text-primary nav-link">Work</a>
  <a href="/" class="z-[1] rounded-full px-4 py-1 text-sm text-text-primary nav-link">About</a>
  <a href="/shop" class="z-[1] rounded-full px-4 py-1 text-sm text-text-primary nav-link">Shop</a>
  <a href="/contact" class="z-[1] rounded-full px-4 py-1 text-sm text-text-primary nav-link">Contact</a>
</nav>

<style>
  /* CSS Variables for navbar styling */
  :root {
    --panel-border: rgba(0, 0, 0, 0.1);
    --panel-background: rgba(255, 255, 255, 0.8);
    --theme-3: rgba(240, 244, 243, 1); 
  }

  html.dark {
    --panel-border: rgba(255, 255, 255, 0.1);
    --panel-background: rgba(28, 28, 28, 0.7);
    --theme-3: rgba(255, 255, 255, 0.25);
  }

  /* Navbar base styles */
  nav.relative {
    position: fixed;
    bottom: 2rem;
    left: 50%;
    transform: translateX(-50%);
    z-index: 1000;
    /* Keep navbar visible during page transitions */
    view-transition-name: floating-navbar;
  }

  /* Utility classes matching Tailwind structure */
  .relative {
    position: relative;
  }

  .z-\[1\] {
    z-index: 1;
  }

  .flex {
    display: flex;
  }

  .items-center {
    align-items: center;
  }

  .gap-2 {
    gap: 0.5rem;
  }

  .rounded-full {
    border-radius: 9999px;
  }

  .border {
    border-width: 1px;
    border-style: solid;
  }

  .border-panel-border {
    border-color: var(--panel-border);
  }

  .bg-panel-background {
    background-color: var(--panel-background);
  }

  .p-1 {
    padding: 0.25rem;
  }

  .shadow-card {
    box-shadow: var(--shadow-card);
  }

  /* Sliding indicator */
  .absolute {
    position: absolute;
  }

  .h-\[90\%\] {
    height: 90%;
  }

  .bg-theme-3 {
    background-color: var(--theme-3);
  }

  .transition-all {
    transition-property: all;
  }

  .duration-300 {
    transition-duration: 300ms;
  }

  .ease-out {
    transition-timing-function: ease-out;
  }

  .sliding-indicator {
    top: 50%;
    transform: translateY(-50%);
    left: 0;
    width: 0;
    opacity: 0;
    pointer-events: none;
    will-change: width, left;
    backface-visibility: hidden;
    -webkit-backface-visibility: hidden;
  }

  .sliding-indicator.visible {
    opacity: 1;
  }

  /* Link styles */
  .px-4 {
    padding-left: 1rem;
    padding-right: 1rem;
  }

  .py-1 {
    padding-top: 0.25rem;
    padding-bottom: 0.25rem;
  }

  .text-sm {
    font-size: 0.875rem;
    line-height: 1.25rem;
  }

  .text-text-primary {
    color: var(--text-primary);
  }

  .nav-link {
    text-decoration: none;
    white-space: nowrap;
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s ease;
  }

  .nav-link:hover,
  .nav-link:focus {
    font-style: italic;
  }

  .nav-link:active {
    transform: scale(0.95);
  }

  /* Responsive adjustments */
  @media (max-width: 768px) {
    nav.relative {
      bottom: 1rem;
    }

    .gap-2 {
      gap: 0.375rem;
    }

    .px-4 {
      padding-left: 0.75rem;
      padding-right: 0.75rem;
    }

    .text-sm {
      font-size: 0.8125rem;
    }
  }

  @media (max-width: 480px) {
    nav.relative {
      bottom: 0.75rem;
    }

    .gap-2 {
      gap: 0.25rem;
    }

    .px-4 {
      padding-left: 0.5rem;
      padding-right: 0.5rem;
    }
  }

  /* Respect reduced motion preferences */
  @media (prefers-reduced-motion: reduce) {
    .transition-all,
    .sliding-indicator {
      transition-duration: 0.15s;
      transition-timing-function: linear;
    }
  }
</style>

<script>
  function updateIndicator() {
    const currentPath = window.location.pathname;
    const navbar = document.querySelector<HTMLElement>('nav[aria-label="Main navigation"]');
    const navLinks = navbar?.querySelectorAll<HTMLAnchorElement>('.nav-link') || [];
    const indicator = navbar?.querySelector<HTMLElement>('.sliding-indicator');
    
    if (!indicator || !navbar) return;
    
    let activeLink: HTMLAnchorElement | null = null;
    
    navLinks.forEach(link => {
      link.classList.remove('active');
      link.removeAttribute('aria-current');
      
      const href = link.getAttribute('href');
      if (!href) return;
      
      // Special handling for home page - only mark as active if we're exactly on the home page
      if (href === '/' && (currentPath === '/' || currentPath === '')) {
        link.setAttribute('aria-current', 'page');
        link.classList.add('active');
        activeLink = link;
      } else if (href !== '/' && currentPath.startsWith(href)) {
        link.setAttribute('aria-current', 'page');
        link.classList.add('active');
        activeLink = link;
      }
    });
    
    // If no active link found, default to the first one (or About)
    if (!activeLink) {
      navLinks.forEach(link => {
        if (link.getAttribute('href') === '/') {
          link.classList.add('active');
          link.setAttribute('aria-current', 'page');
          activeLink = link;
        }
      });
    }
    
    if (activeLink && indicator && navbar) {
      const link = activeLink as HTMLAnchorElement;
      const linkRect = link.getBoundingClientRect();
      const navbarRect = navbar.getBoundingClientRect();
      
      // Calculate position relative to navbar
      // The indicator should be positioned at the left edge of the active link
      const left = linkRect.left - navbarRect.left;
      const width = linkRect.width;
      
      // Set inline styles matching the example structure
      indicator.style.left = `${left}px`;
      indicator.style.width = `${width}px`;
      
      // Show indicator once positioned
      if (width > 0) {
        indicator.classList.add('visible');
      }
    }
  }
  
  // Update on page load with proper timing
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', () => {
      // Small delay to ensure layout is stable
      requestAnimationFrame(() => {
        requestAnimationFrame(updateIndicator);
      });
    });
  } else {
    // DOM already loaded
    requestAnimationFrame(() => {
      requestAnimationFrame(updateIndicator);
    });
  }
  
  // Update on navigation (for Astro view transitions)
  document.addEventListener('astro:page-load', () => {
    // Keep indicator visible during transition
    const indicator = document.querySelector<HTMLElement>('.sliding-indicator');
    if (indicator) {
      indicator.classList.add('visible');
    }
    
    requestAnimationFrame(() => {
      requestAnimationFrame(updateIndicator);
    });
  });

  // Also listen for before transition to maintain visibility
  document.addEventListener('astro:before-preparation', () => {
    const indicator = document.querySelector<HTMLElement>('.sliding-indicator');
    if (indicator) {
      indicator.classList.add('visible');
    }
  });
  
  // Handle window resize to maintain accuracy
  let resizeTimeout: ReturnType<typeof setTimeout>;
  window.addEventListener('resize', () => {
    clearTimeout(resizeTimeout);
    resizeTimeout = setTimeout(() => {
      requestAnimationFrame(updateIndicator);
    }, 150);
  });
</script>

